swagger: '2.0'
info:
  description: >+
    **IMPORTANT!!!!** We are preparing the documentation and will update this site
    regularly. This notice will remain until the site is ready for initial use.
    Please refer to our current [portal for
    developers](https://www.vipps.no/bedrift/utvikler) in the meantime.

    # Recurring payments

    Recurring payments is used for subscription payments such as weekly dues for newspaper access, monthly dues for public transportation, etc.1. A a draft agreement is initialized and the user is redirected for approval.rn2. The user approves the agreement and the merchant can call GET on the agreement to verify the statusrn3. The merchant can start sending charges which will be charged the user in the future.The merchant is responsible for checking the status of charges, and cancelling any user access if charges are failing (or contacting the user)

    # Authenthication

    For information regarding authenthication please read:https://github.com/vippsas/vipps-recurring-api/blob/master/vipps-recurring-api.md#api-access-token
  version: '1.0'
  title: Vipps eCommerce APIs
basePath: /at3/vipps-recurring-merchant-api
tags:
  - name: agreement-controller
    description: Agreement Controller
  - name: charge-controller
    description: Charge Controller
  - name: draft-agreement-controller
    description: Draft Agreement Controller
  - name: health-check-controller
    description: Health Check Controller
  - name: swagger-export-json-controller
    description: Swagger Export Json Controller
  - name: swagger-export-yaml-controller
    description: Swagger Export Yaml Controller
paths:
  /api/v1/agreement:
    get:
      tags:
        - agreement-controller
      summary: List Agreements
      operationId: listUsingGET
      produces:
        - application/json;charset=UTF-8
      parameters:
        - name: Authorization
          in: header
          description: Bearer 'auth token'
          required: true
          type: string
        - name: MerchantId
          in: header
          description: merchantId
          required: true
          type: string
        - name: status
          in: query
          description: Filter by status
          required: false
          type: string
          allowEmptyValue: false
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/Agreement'
        '400':
          description: Bad Request
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '503':
          description: Service unavailable
        '504':
          description: Gateway Timeout
      deprecated: false
  '/api/v1/agreement/{agreementId}':
    get:
      tags:
        - agreement-controller
      summary: Fetch an Agreement
      operationId: getUsingGET
      produces:
        - application/json;charset=UTF-8
      parameters:
        - name: Authorization
          in: header
          description: Bearer 'auth token'
          required: true
          type: string
        - name: MerchantId
          in: header
          description: merchantId
          required: true
          type: string
        - name: agreementId
          in: path
          description: Agreement ID
          required: true
          type: string
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/Agreement'
        '400':
          description: Bad Request
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '401':
          description: Unauthorized
        '404':
          description: Agreement not found
        '500':
          description: Internal Server Error
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '503':
          description: Service unavailable
        '504':
          description: Gateway Timeout
      deprecated: false
    post:
      tags:
        - agreement-controller
      summary: Update an Agreement
      operationId: updateUsingPOST
      consumes:
        - application/json
      produces:
        - application/json;charset=UTF-8
      parameters:
        - name: Authorization
          in: header
          description: Bearer 'auth token'
          required: true
          type: string
        - name: MerchantId
          in: header
          description: merchantId
          required: true
          type: string
        - in: body
          name: agreement
          description: agreement
          required: true
          schema:
            $ref: '#/definitions/Agreement'
        - name: agreementId
          in: path
          description: Agreement ID
          required: true
          type: string
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/Agreement'
        '400':
          description: Bad Request
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '401':
          description: Unauthorized
        '404':
          description: Agreement not found
        '500':
          description: Internal Server Error
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '503':
          description: Service unavailable
        '504':
          description: Gateway Timeout
      deprecated: false
  '/api/v1/charge/{agreementId}':
    get:
      tags:
        - charge-controller
      summary: List Charges
      operationId: listUsingGET_1
      produces:
        - application/json;charset=UTF-8
      parameters:
        - name: Authorization
          in: header
          description: Bearer 'auth token'
          required: true
          type: string
        - name: MerchantId
          in: header
          description: merchantId
          required: true
          type: string
        - name: agreementId
          in: path
          description: The agreement identifier (id)
          required: true
          type: string
        - name: chargeStatus
          in: query
          description: The status of the charge
          required: false
          type: string
          allowEmptyValue: false
          enum:
            - PENDING
            - DUE
            - REFUNDED
            - CHARGED
            - FAILED
            - CANCELLED
      responses:
        '200':
          description: Success
          schema:
            type: array
            items:
              $ref: '#/definitions/Charge'
        '400':
          description: 'Invalid request, check your parameters'
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '500':
          description: Internal server error
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '503':
          description: Service unavailable
        '504':
          description: Timeout
      deprecated: false
    post:
      tags:
        - charge-controller
      summary: Create a new charge for a given agreement and customer
      operationId: createUsingPOST
      consumes:
        - application/json;charset=UTF-8
      produces:
        - application/json;charset=UTF-8
      parameters:
        - name: Authorization
          in: header
          description: Bearer 'auth token'
          required: true
          type: string
        - name: Idempotent-Key
          in: header
          description: Idempotent-Key
          required: true
          type: string
        - name: MerchantId
          in: header
          description: merchantId
          required: true
          type: string
        - name: agreementId
          in: path
          description: Agreement ID
          required: true
          type: string
        - in: body
          name: dto
          description: dto
          required: true
          schema:
            $ref: '#/definitions/Charge'
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/Charge'
        '201':
          description: Created
          schema:
            $ref: '#/definitions/Charge'
        '204':
          description: No Content (operation succeeded previously)
          schema:
            $ref: '#/definitions/Charge'
        '400':
          description: 'Invalid request, check your parameters'
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '409':
          description: 'Conflict, retry in a moment. (simultaneous idempotent requests)'
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '500':
          description: Internal server error
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '503':
          description: Service unavailable
        '504':
          description: Timeout
      deprecated: false
  '/api/v1/charge/{agreementId}/{chargeId}':
    get:
      tags:
        - charge-controller
      summary: Fetch a Charge
      operationId: getUsingGET_1
      produces:
        - application/json;charset=UTF-8
      parameters:
        - name: Authorization
          in: header
          description: Bearer 'auth token'
          required: true
          type: string
        - name: MerchantId
          in: header
          description: merchantId
          required: true
          type: string
        - name: agreementId
          in: path
          description: agreementId
          required: true
          type: string
        - name: chargeId
          in: path
          description: The charge identifier (id)
          required: true
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/Charge'
        '404':
          description: The requested charge does not exist
        '500':
          description: Internal server error
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '503':
          description: Service unavailable
        '504':
          description: Timeout
      deprecated: false
    delete:
      tags:
        - charge-controller
      summary: Cancel a Charge
      operationId: cancelUsingDELETE
      produces:
        - application/json;charset=UTF-8
      parameters:
        - name: Authorization
          in: header
          description: Bearer 'auth token'
          required: true
          type: string
        - name: MerchantId
          in: header
          description: merchantId
          required: true
          type: string
        - name: agreementId
          in: path
          description: The agreement identifier (id)
          required: true
          type: string
        - name: chargeId
          in: path
          description: The charge identifier (id)
          required: true
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/Charge'
        '204':
          description: No Content (operation succeeded previously)
          schema:
            $ref: '#/definitions/Charge'
        '400':
          description: 'Invalid request, check your parameters'
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '409':
          description: 'This charge is not in a deletable state, it may have already been charged to the user.'
        '500':
          description: Internal server error
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '503':
          description: Service unavailable
        '504':
          description: Timeout
      deprecated: false
  '/api/v1/charge/{agreementId}/{chargeId}/refund':
    post:
      tags:
        - charge-controller
      summary: Refund a charge
      operationId: refundUsingPOST
      consumes:
        - application/json
      produces:
        - application/json;charset=UTF-8
      parameters:
        - name: Authorization
          in: header
          description: Bearer 'auth token'
          required: true
          type: string
        - name: MerchantId
          in: header
          description: merchantId
          required: true
          type: string
        - name: agreementId
          in: path
          description: The agreement identifier (id)
          required: true
          type: string
        - name: chargeId
          in: path
          description: The charge identifier (id)
          required: true
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/ResponseEntity'
        '400':
          description: 'Invalid request, check your parameters'
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '404':
          description: Charge does not exist (and never has)
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '500':
          description: Internal server error
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '503':
          description: Service unavailable
        '504':
          description: Timeout
      deprecated: false
  /api/v1/draftAgreement:
    post:
      tags:
        - draft-agreement-controller
      summary: Send a new customer to Vipps in order to accept AgreementDto
      operationId: registerUsingPOST
      consumes:
        - application/json;charset=UTF-8
      produces:
        - application/json;charset=UTF-8
      parameters:
        - name: Authorization
          in: header
          description: Bearer 'auth token'
          required: true
          type: string
        - name: MerchantId
          in: header
          description: merchantId
          required: true
          type: string
        - in: body
          name: draftAgreement
          description: draftAgreement
          required: true
          schema:
            $ref: '#/definitions/DraftAgreement'
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/DraftAgreementResponse'
        '201':
          description: OK
          schema:
            $ref: '#/definitions/DraftAgreementResponse'
        '400':
          description: Bad Request
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '401':
          description: Unauthorized
        '422':
          description: Unprocessable Entity (invalid json)
        '500':
          description: Internal Server Error
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDto'
        '503':
          description: Service unavailable
        '504':
          description: Gateway Timeout
      deprecated: false
  /health:
    get:
      tags:
        - health-check-controller
      summary: heathCheck
      operationId: heathCheckUsingGET
      produces:
        - application/json;charset=UTF-8
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/HealthCheckStatus'
      deprecated: false
  /swagger.json:
    get:
      tags:
        - swagger-export-json-controller
      summary: Export
      description: 'Download the latest version of the Swagger Documentation for this service, in json format'
      operationId: swaggerJsonSpecUsingGET
      produces:
        - '*/*'
      responses:
        '200':
          description: OK
          schema:
            type: string
      deprecated: false
  /swagger.yaml:
    get:
      tags:
        - swagger-export-yaml-controller
      summary: Export
      description: Download the latest version of the Swagger Documentation for this service
      operationId: swaggerYmlSpecUsingGET
      produces:
        - '*/*'
      responses:
        '200':
          description: OK
          schema:
            type: string
      deprecated: false
definitions:
  Agreement:
    type: object
    required:
      - interval
      - intervalCount
      - price
      - productDescription
      - productName
      - status
    properties:
      currency:
        type: string
        example: NOK
        enum:
          - NOK
      customer:
        type: integer
        format: int64
        example: 12345
        description: Identifies the customer (Vipps-user)
        readOnly: true
      id:
        type: string
        example: agr_5kSeqzFAMkfBbc
        description: Uniquely identifies this agreement
        readOnly: true
      interval:
        type: string
        example: week
        description: Interval for subscription
        enum:
          - day
          - week
          - month
      intervalCount:
        type: integer
        format: int32
        example: 2
        description: 'Number of intervals between charges. Example: interval=week, intervalCount=2 to be able to charge every two weeks. Charges should occur at least once a year.'
        minimum: 1
        maximum: 31
        exclusiveMinimum: false
        exclusiveMaximum: false
      maxCharge:
        type: integer
        format: int32
        example: 12000
        description: 'Maximum limit set by Vipps-user. Treated as a whole sum postfixed with two decimals for cents, eg 234 = 2.34 NOK ,'
        readOnly: true
      price:
        type: integer
        format: int32
        example: 7900
        description: 'Treated as a whole sum postfixed with two decimals for cents, eg 234 = 2.34 NOK'
      productDescription:
        type: string
        example: Fin abonnementspakke
      productName:
        type: string
        example: Pluss-abonnement
        description: Name of the product being subscribed to.
      startDate:
        type: string
        example: '2018-10-22'
        description: Date when agreement was started.
        readOnly: true
      status:
        type: string
        example: stoppedByMerchant
        description: Status of AgreementDto.
        enum:
          - pendingUserApproval
          - active
          - stoppedByUser
          - stoppedByMerchant
          - stoppedByVipps
      stopDate:
        type: string
        example: '2019-10-22'
        description: Date when agreement was stopped.
        readOnly: true
    title: Agreement
  Charge:
    type: object
    required:
      - amount
      - description
      - type
      - dueDate
    properties:
      amount:
        type: integer
        format: int32
        example: 234
        description: 'Treated as a whole sum postfixed with two decimals for cents, eg 234 = 2.34 NOK'
      currency:
        type: string
        example: NOK
        enum:
          - NOK
      description:
        type: string
        example: Månedsabonnement
        description: This field is visible to the end user in-app
      dueDate:
        type: string
        example: "2020-12-31"
      retryDays:
        type: integer
        format: int32
        example: 5
        description: 'The service will attempt to charge the customer for N days [non inclusive]. Must be null (vipps decides a default value) or contain a value from 0 to 10. If zero, no retries will be performed. The retry period must not pass the charge date for the next charge.'
      type:
        type: string
        description: Only ONEOFF is allowed for the initial optional charge
        enum:
          - RECURRING
          - ONEOFF
    title: Charge
  DraftAgreementCharge:
    type: object
    required:
      - amount
      - description
      - type
      - dueDate
    properties:
      amount:
        type: integer
        format: int32
        example: 234
        description: 'Treated as a whole sum postfixed with two decimals for cents, eg 234 = 2.34 NOK'
      currency:
        type: string
        example: NOK
        enum:
          - NOK
      description:
        type: string
        example: Månedsabonnement
        description: This field is visible to the end user in-app
      retryDays:
        type: integer
        format: int32
        example: 5
        description: 'The service will attempt to charge the customer for N days [non inclusive]. Must be null (vipps decides a default value) or contain a value from 0 to 10. If zero, no retries will be performed. The retry period must not pass the charge date for the next charge.'
      type:
        type: string
        description: Only ONEOFF is allowed for the initial optional charge
        enum:
          - RECURRING
          - ONEOFF
    title: Charge
  DraftAgreement:
    type: "object"
    required:
    - "currency"
    - "interval"
    - "intervalCount"
    - "isApp"
    - "merchantRedirectUrl"
    - "merchantSubscriptionUrl"
    - "price"
    - "productDescription"
    - "productName"
    properties:
      currency:
        type: "string"
        example: "NOK"
        enum:
        - "NOK"
      customerPhoneNumber:
        type: "string"
        example: "+4740000000"
        description: "Customers phone number (if available). Used to simplify the
           following Vipps interaction"
      initialCharge:
        $ref: "#/definitions/InitialCharge"
      interval:
        type: "string"
        example: "WEEK"
        description: "Interval for subscription"
        enum:
        - "WEEK"
        - "YEAR"
        - "MONTH"
        - "DAY"
      intervalCount:
        type: "integer"
        format: "int32"
        example: 2
        description: "Number of intervals between charges. Example: interval=week,
           intervalCount=2 to be able to charge every two weeks. Charges should occur
           at least once a year"
        minimum: 1
        maximum: 31
        exclusiveMinimum: false
        exclusiveMaximum: false
      isApp:
        type: "boolean"
        example: true
        description: "If merchant is redirecting user from an app."
      merchantRedirectUrl:
        type: "string"
        example: "https://api.merchant.no/landing"
        description: "URL where customer should be redirected after the agreement
           has been approved/rejected in the Vipps mobile application."
      merchantSubscriptionUrl:
        type: "string"
        example: "https://www.merchant.no/subscriptions/1234/"
        description: "URL where Vipps can redirect the customer to view/administer
           their subscription."
      oneOffCharge:
        $ref: "#/definitions/OneOffCharge"
      price:
        type: "integer"
        format: "int32"
        example: 7900
        description: "Treated as a whole sum postfixed with two decimals for cents,
           eg 234 = 2.34 NOK"
      productDescription:
        type: "string"
        example: "Fin abonnementspakke"
      productName:
        type: "string"
        example: "Pluss-abonnement"
        description: "Name of the product being subscribed to."
    title: "DraftAgreement"
  DraftAgreementResponse:
    type: "object"
    properties:
      agreementResource:
        type: "string"
        example: "https://api.vipps.no/api/v1/agreement/agr_5kSeqzFAMkfBbc"
        description: "Reference to AgreementDto which user may agree to. Initially
           the AgreementDto is in a pendingUserApproval state, and it enters active
           state once user has approved in the Vipps application."
        readOnly: true
      redirectToVipps:
        type: "string"
        example: "https://api.vipps.no/api/v1/register/U6JUjQXq8HQmmV"
        description: "Customer should be redirected to Vipps using this URL."
        readOnly: true
    title: "DraftAgreementResponse"
  InitialCharge:
    type: "object"
    required:
    - "amount"
    - "description"
    properties:
      amount:
        type: "integer"
        format: "int32"
        example: 234
        description: "Treated as a whole sum postfixed with two decimals for cents,
           eg 234 = 2.34 NOK"
      currency:
        type: "string"
        example: "NOK"
        enum:
        - "NOK"
      description:
        type: "string"
        example: "Månedsabonnement"
        description: "This field is visible to the end user in-app"
      retryDays:
        type: "integer"
        format: "int32"
        example: 5
        description: "The service will attempt to charge the customer for N days [non
           inclusive], must be null or contain a value >= 0. If zero, no retries
           will be performed"
    title: "InitialCharge"
    description: "An initial charge for a new agreement. The charge will be executed
       immediately when the user approves the agreement."
  OneOffCharge:
    type: "object"
    required:
    - "amount"
    - "description"
    properties:
      amount:
        type: "integer"
        format: "int32"
        example: 234
        description: "Treated as a whole sum postfixed with two decimals for cents,
           eg 234 = 2.34 NOK"
      currency:
        type: "string"
        example: "NOK"
        enum:
        - "NOK"
      description:
        type: "string"
        example: "Månedsabonnement"
        description: "This field is visible to the end user in-app"
    title: "OneOffCharge"
    description: "An one-off charge with this agreement. For example a bundles sale
       (product + subscription)."
  ErrorDto:
    type: object
    properties:
      description:
        type: string
      error:
        type: string
      field:
        type: string
    title: ErrorDto
  HealthCheckStatus:
    type: object
    properties:
      application:
        type: boolean
      cosmosDb:
        type: boolean
      paymentDb:
        type: boolean
    title: HealthCheckStatus
  ResponseEntity:
    type: object
    properties:
      body:
        type: object
      statusCode:
        type: string
        enum:
          - '100'
          - '101'
          - '102'
          - '103'
          - '200'
          - '201'
          - '202'
          - '203'
          - '204'
          - '205'
          - '206'
          - '207'
          - '208'
          - '226'
          - '300'
          - '301'
          - '302'
          - '303'
          - '304'
          - '305'
          - '307'
          - '308'
          - '400'
          - '401'
          - '402'
          - '403'
          - '404'
          - '405'
          - '406'
          - '407'
          - '408'
          - '409'
          - '410'
          - '411'
          - '412'
          - '413'
          - '414'
          - '415'
          - '416'
          - '417'
          - '418'
          - '419'
          - '420'
          - '421'
          - '422'
          - '423'
          - '424'
          - '426'
          - '428'
          - '429'
          - '431'
          - '451'
          - '500'
          - '501'
          - '502'
          - '503'
          - '504'
          - '505'
          - '506'
          - '507'
          - '508'
          - '509'
          - '510'
          - '511'
      statusCodeValue:
        type: integer
        format: int32
    title: ResponseEntity
